<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hydra Substance Experience</title>
    <script src="https://unpkg.com/hydra-synth"></script>
    <script src="https://unpkg.com/tone"></script>
    <style>
        body, html {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            background-color: black;
            overflow: hidden;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        #hydra-canvas {
            width: 100%;
            height: 100%;
        }
        #ui-overlay {
            position: absolute;
            z-index: 10;
            color: white;
            font-family: 'Arial', sans-serif;
            text-align: center;
            cursor: pointer;
            border: 2px solid white;
            padding: 20px;
            background: rgba(0,0,0,0.7);
            letter-spacing: 2px;
        }
    </style>
</head>
<body>

    <div id="ui-overlay">CLICCA PER ATTIVARE IL PROCESSO</div>
    <canvas id="hydra-canvas"></canvas>

    <script>
        // 1. Inizializzazione Hydra
        const hydra = new Hydra({
            canvas: document.getElementById("hydra-canvas"),
            detectAudio: false
        });

        // Helper per caricare lo script delle GIF
        const loadScript = (url) => new Promise((resolve) => {
            const script = document.createElement("script");
            script.src = url;
            script.onload = resolve;
            document.head.appendChild(script);
        });

        async function startApp() {
            // Rimuovi overlay
            document.getElementById('ui-overlay').style.display = 'none';
            
            // Attiva Audio Context
            await Tone.start();

            // Carica plugin GIF
            await loadScript("https://cdn.jsdelivr.net/gh/geikha/hyper-hydra@latest/hydra-gif.js");

            // --- CONFIGURAZIONE AUDIO ---
            const dist = new Tone.Distortion(0.8).toDestination();
            const verb = new Tone.Reverb(2).toDestination();
            const synth = new Tone.MembraneSynth({
                pitchDecay: 0.05,
                octaves: 4,
                oscillator: { type: "sine" },
                envelope: { attack: 0.001, decay: 0.8, sustain: 0.01, release: 1.4 }
            }).connect(dist).connect(verb);

            // --- SORGENTI VISIVE ---
            // Sfondo principale
            s0.initGif('https://raw.githubusercontent.com/NgaLegins/Synthesis10/main/Daily%20Flicks.gif');
            
            // GIF Substance (usando il formato gif come richiesto)
            s2.initGif('https://github.com/NgaLegins/Synthesis10/blob/main/Substance%20GIF.gif?raw=true');

            // Canvas per il testo
            const textCanvas = document.createElement("canvas");
            textCanvas.width = 1280;
            textCanvas.height = 720;
            const ctx = textCanvas.getContext("2d");
            s1.init({ src: textCanvas });

            // --- LOGICA DI CONTROLLO ---
            const words = ["REMEMBER", "YOU", "ARE", "ONE"];
            let lastIndex = -1;
            window.isOne = 0;

            // Loop di aggiornamento
            update = () => {
                let index = Math.floor(time * 1) % words.length; 
                window.isOne = (index === 3) ? 1 : 0;

                if (index !== lastIndex) {
                    ctx.clearRect(0, 0, textCanvas.width, textCanvas.height);
                    
                    // Colore: Rosso se "ONE", Bianco altrimenti
                    ctx.fillStyle = (index === 3) ? "red" : "white";
                    ctx.font = "bold 250px Arial"; 
                    ctx.textAlign = "center";
                    ctx.textBaseline = "middle";
                    ctx.fillText(words[index], textCanvas.width / 2, textCanvas.height / 2);
                    
                    // Suono d'impatto (G0 per ONE, C1 per gli altri)
                    let note = (index === 3) ? "G0" : "C1";
                    synth.triggerAttackRelease(note, "8n");
                    
                    lastIndex = index;
                }
            }

            // --- COMPOSIZIONE FINALE ---
            src(s0)
                .scale(1, 0.6)
                .layer(
                    src(s1)
                    .luma(0.1, 0.1)
                )
                .layer(
                    src(s2).scale(1.2), 
                    () => window.isOne
                )
                .modulate(noise(2), () => window.isOne * 0.05) 
                .out();
        }

        // Avvio al click
        document.getElementById('ui-overlay').onclick = startApp;
    </script>
</body>
</html>
