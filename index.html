<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>The Substance - Mobile Interaction</title>
    <style>
        /* Reset e blocco scroll */
        html, body {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            background-color: black;
            overflow: hidden; /* Fondamentale per bloccare lo scroll */
            touch-action: none; /* Disabilita zoom e pan nativi */
            font-family: 'Helvetica Neue', Arial, sans-serif;
        }

        /* Canvas a tutto schermo */
        #hydra-canvas {
            display: block;
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1;
        }

        /* Bottone START (Necessario per policy mobile) */
        #overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: black;
            z-index: 9999;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
        }

        #start-btn {
            color: white;
            border: 2px solid white;
            padding: 20px 40px;
            font-size: 1.2rem;
            font-weight: 900;
            letter-spacing: 4px;
            text-transform: uppercase;
            background: transparent;
            pointer-events: none; /* Clicca sul div padre */
        }
    </style>
</head>
<body>

    <div id="overlay">
        <div id="start-btn">TAP TO ACTIVATE</div>
    </div>

    <canvas id="hydra-canvas"></canvas>

    <script src="https://unpkg.com/hydra-synth"></script>

    <script>
        // Aspettiamo che la pagina sia pronta
        window.onload = function() {
            const overlay = document.getElementById('overlay');
            const canvas = document.getElementById("hydra-canvas");
            let isStarted = false;

            // Funzione per avviare tutto al primo tocco
            const startExperience = (e) => {
                if (isStarted) return;
                isStarted = true;
                
                // Nascondi overlay
                overlay.style.opacity = 0;
                setTimeout(() => { overlay.style.display = 'none'; }, 500);

                // Avvia Hydra
                initHydra();
            };

            overlay.addEventListener('click', startExperience);
            overlay.addEventListener('touchstart', startExperience, {passive: false});

            function initHydra() {
                // Setup Hydra
                const hydra = new Hydra({
                    canvas: canvas,
                    detectAudio: false,
                    enableStreamCapture: false,
                    makeGlobal: true
                });

                // --- GESTIONE TOUCH (LOGICA PRESA DAL TUO ESEMPIO) ---
                // Hydra si aspetta mouse.x / mouse.y tra 0 e 1.
                // Usiamo il touch event per aggiornare queste variabili manualmente.

                const updateTouch = (e) => {
                    // Impedisce lo scroll della pagina (fondamentale)
                    e.preventDefault(); 
                    
                    let clientX, clientY;

                    // Se è touch
                    if (e.touches && e.touches.length > 0) {
                        clientX = e.touches[0].clientX;
                        clientY = e.touches[0].clientY;
                    } 
                    // Se è mouse (fallback per PC)
                    else {
                        clientX = e.clientX;
                        clientY = e.clientY;
                    }

                    // Normalizziamo le coordinate da 0 a 1 per Hydra
                    // (0 = sinistra/alto, 1 = destra/basso)
                    if (typeof mouse !== 'undefined') {
                        mouse.x = clientX / window.innerWidth;
                        mouse.y = clientY / window.innerHeight;
                    }
                };

                // Aggiungiamo i listener con { passive: false } per poter usare preventDefault()
                document.addEventListener('touchmove', updateTouch, { passive: false });
                document.addEventListener('touchstart', updateTouch, { passive: false });
                document.addEventListener('mousemove', updateTouch);

                // Setup Risoluzione
                setResolution(window.innerWidth, window.innerHeight);

                // --- SCRITTA: ACTIVATE YOUR SUBCONSCIOUS ---
                const textCanvas = document.createElement('canvas');
                const ctx = textCanvas.getContext('2d');

                function updateText() {
                    textCanvas.width = window.innerWidth;
                    textCanvas.height = window.innerHeight;
                    ctx.clearRect(0, 0, textCanvas.width, textCanvas.height);
                    
                    // Dimensione font reattiva
                    const fontSize = Math.max(16, Math.floor(window.innerWidth * 0.05)); 
                    ctx.font = '900 ' + fontSize + 'px Helvetica Neue, Arial, sans-serif';
                    ctx.fillStyle = '#FFFFFF';
                    ctx.textAlign = 'center';
                    ctx.letterSpacing = '3px';

                    const text = "ACTIVATE YOUR SUBCONSCIOUS";
                    ctx.fillText(text, textCanvas.width / 2, textCanvas.height * 0.93);
                }

                updateText();
                window.addEventListener('resize', () => {
                    setResolution(window.innerWidth, window.innerHeight);
                    updateText();
                });
                
                s0.init({ src: textCanvas, dynamic: true });

                // --- SCRIPT VISUALE (THE SUBSTANCE) ---
                src(o0)
                  .scale(1.05) 
                  .modulate(noise(3, 0.1)) 
                  .blend(
                    voronoi(8, 2, 5) 
                      .modulateScale(osc(10, 0.1, 0.5), 0.5) 
                      .modulateRotate(noise(2, 0.2), () => (mouse.x * 0.005)) 
                      .thresh(0.3, 0.0) 
                      .color(
                        () => 1 + (mouse.y * 0.001), 
                        () => 0.4 + (mouse.y * 0.005), 
                        () => 0.4 
                      )
                      .contrast(1.4)
                      .brightness(0.1),
                    0.1 
                  )
                  .modulatePixelate(noise(25, 0.5), 100, 8) 
                  .layer(src(s0)) 
                  .out(o0);
            }
        };
    </script>
</body>
</html>
